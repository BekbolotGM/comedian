version: '3'

services:

  db:
    image: percona/percona-server:5.7 
    restart: on-failure
    volumes:
      - "./docker:/var/lib/mysql"
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: comedian
      MYSQL_USER: comedian
      MYSQL_PASSWORD: comedian

  comedian:
    image: comedian:latest
    restart: on-failure
    ports:
      - 8080:8080
    links:
      - db:db
    environment:
      TZ: Asia/Bishkek
      COMEDIAN_HTTP_BIND_ADDR: 0.0.0.0:8080
      COMEDIAN_SLACK_TOKEN: ${COMEDIAN_SLACK_TOKEN}
      COMEDIAN_SLACK_DOMAIN: "yourSlackDomain"
      COMEDIAN_DATABASE: comedian:comedian@tcp(db:3306)/comedian?parseTime=true
      COMEDIAN_REMINDER_REPEATS_MAX: "2"
      COMEDIAN_REMINDER_TIME: "3"
      COMEDIAN_NOTIFIER_INTERVAL: "1"
      COMEDIAN_REPORT_TIME: "20:06"
      COMEDIAN_REPORTING_CHANNEL: "yourSlackChannel"
      COMEDIAN_MANAGER_SLACK_USER_ID: "yourSlackUserID"
      COMEDIAN_LANGUAGE: "ru_RU"
      COMEDIAN_ENABLE_TEAM_MONITORING: "true"
      COMEDIAN_COLLECTOR_TOKEN: ${COMEDIAN_COLLECTOR_TOKEN}
      COMEDIAN_COLLECTOR_URL: ${COMEDIAN_COLLECTOR_URL}  
    depends_on:
      - db
